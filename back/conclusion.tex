% !Mode:: "TeX:UTF-8" 
\begin{conclusions}

本文围绕着为RISC-V开源处理器“香山”的南湖架构添加虚拟化扩展，
讲述了对虚拟化微架构、系统软件和调试工具三个方面的研究。

第一，在虚拟化微架构上，扩展了“香山”特权控制和虚拟内存两部分的设计，从而实现了虚拟化扩展。
特别是虚拟内存部分，通过添加第二阶段地址翻译单元、实现了第二阶段页表翻译。
还通过复用二级页表缓存、猝发传输获取页表、压缩一级页表缓存表项等的微架构加快了翻译速度。
本文将虚拟化扩展的“香山”处理器代码开源：\url{https://gitlab.agileserve.org.cn:8001/huguanghui/XiangShan}。

第二，在添加虚拟化扩展的“香山”上尝试启动Linux和虚拟机管理系统KVM。
在FPGA加速仿真工具REMU的调试帮助下，Linux能够顺利启动。
在Linux中，通过使用常见的基准测试对主机性能进行了评测，发现硬件虚拟化扩展对主机性能影响不大。
但是在启动KVM虚拟机时，由于硬件设计还是存在尚未发掘的错误而失败。

第三，为了找出错误，尝试了基于纯软件逻辑仿真的差分测试以及基于FPGA的加速仿真平台等调试工具。
但由于软硬件联合调试的复杂性以及现有调试工具的能力限制，问题未能解决。
因此，对扩展现有调试工具的能力方面进行了探索：
基于纯软件仿真的差分测试工具，可以联合使用体系结构信息检查点，跳过不必要的操作系统仿真步骤。
基于FPGA的加速仿真工具，可以在差分测试框架中重放微架构检查点，或者是将差分测试硬件化在FPGA中。
尽管该部分由于时间限制只完成了部分，这会成为未来的研究方向。

\end{conclusions}
