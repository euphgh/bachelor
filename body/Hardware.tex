\chapter{“香山”处理器虚拟化扩展的设计}

\section{特权相关部件设计扩展}
特权级、特权指令，涉及访存流水线，取指流水线、ROB等修改

通过在硬件中添加Virtual位到原始的特权级别中，
代表是否是虚拟机模式还是虚拟机管理模式，用于区分HS和VS，U和VU。
除了特权级，还需要添加相关的RISC-V控制状态寄存器（Control Status Register）是虚拟机管理模式（HS-mode）下的hstatus、hdeleg、hvip等，他们用于处理虚拟机管理程序的中断委托、使能。
处理器捕获相关敏感指令的能力。

\section{内存管理单元设计扩展}

一级页表缓冲：新增表项，组织方法

页表遍历单元：新增Hypervisor Page Table Walker

二级页表缓冲：两段页表共用，如何替换

\section{设计扩展正确性评测}

运行hyp-test，验证基本功能的正确性