% !Mode:: "TeX:UTF-8"

\hitsetup{
  %******************************
  % 注意：
  %   1. 配置里面不要出现空行
  %   2. 不需要的配置信息可以删除
  %******************************
  %
  %=====
  % 秘级
  %=====
  statesecrets={公开},
  natclassifiedindex={TM301.2},
  intclassifiedindex={62-5},
  %
  %=========
  % 中文信息
  %=========
ctitleone={高性能RISC-V开源处理},%本科生封面使用
ctitletwo={器虚拟化扩展与系统评测},%本科生封面使用
  ctitlecover={高性能RISC-V开源处理器\\虚拟化扩展与系统评测},%放在封面中使用，自由断行
  ctitle={高性能RISC-V开源处理器虚拟化扩展与系统评测},%放在原创性声明中使用
  % csubtitle={一条副标题}, %一般情况没有，可以注释掉
  cxueke={工学},
  csubject={计算机科学与技术},
  caffil={计算学部},
  cauthor={胡光辉},
  csupervisor={黄庆成副教授},
  cassosupervisor={某某某教授}, % 副指导老师
  ccosupervisor={某某某教授}, % 联合指导老师
  % 如果是深圳本科毕业论文，需要取消注释下一行，并将内容改为“规范”中要求的封面第一页最下方的日期
% szshortcdate={2024年6月},
  % 日期自动使用当前时间，若需指定按如下方式修改：
  %cdate={超新星纪元},
  cstudentid={120L052208},
  % cstudenttype={学术学位论文}, %非全日制教育申请学位者
  % cnumber={no9527}, %编号
  % cpositionname={哈铁西站}, %博士后站名称
  % cfinishdate={20XX年X月---20XX年X月}, %到站日期
  % csubmitdate={20XX年X月}, %出站日期
  % cstartdate={3050年9月10日}, %到站日期
  % cenddate={3090年10月10日}, %出站日期
  %（同等学力人员）、（工程硕士）、（工商管理硕士）、
  %（高级管理人员工商管理硕士）、（公共管理硕士）、（中职教师）、（高校教师）等
  %
  %
  %=========
  % 英文信息
  %=========
  etitle={Research on key technologies of partial porous externally pressurized gas bearing},
  esubtitle={This is the sub title},
  exueke={Engineering},
  esubject={Computer Science and Technology},
  eaffil={\emultiline[t]{School of Mechatronics Engineering \\ Mechatronics Engineering}},
  eauthor={Yu Dongmei},
  esupervisor={Professor XXX},
  eassosupervisor={XXX},
  % 日期自动生成，若需指定按如下方式修改：
  edate={December, 2017},
  estudenttype={Master of Art},
  %
  % 关键词用“英文逗号”分割
ckeywords={RISC-V, 高性能处理器, 虚拟化, 系统评测},
ekeywords={RISC-V, High-performance processor, Virtualization, System evaluation},
}

\begin{cabstract}
虚拟化是一项在云服务和数据中心中广泛使用的关键技术。
在需求的推动下，主流计算机体系结构已纷纷实现了虚拟化的硬件扩展支持。
作为一种新兴的开源指令集，RISC-V也开始关注云数据中心的需求，
于是提出了处理器的虚拟化扩展规范，这为研究提供了巨大的空间。
本文尝试以高性能开源处理器“香山”为中心，构建一个支持虚拟化扩展的RISC-V计算机系统。
具体而言，需要先在处理器硬件级别进行虚拟化扩展的微架构设计，
然后基于硬件平台对虚拟机管理软件进行适配，尝试在处理器中启动管理软件和虚拟机。
最后对软硬件整体进行系统级评测。

在处理器微架构方面，虚拟化扩展的实现主要需要扩展了“香山”的特权管理单元和虚拟内存单元。
在虚拟内存单元方面，我采用了分布式的一级页表缓存和集中式的地址翻译引擎，以平衡翻译速度和时序压力。
还通过在二级页表缓存中缓存第二阶段的页表，加快了第二阶段地址翻译的速度。
最后，在页表翻译单元中还设计了一些能够提高吞吐量的微架构。

在虚拟机管理软件方面，我选择Linux-KVM作为硬件平台的适配目标。
在添加虚拟化扩展后的“香山”上启动了Linux，并对主机性能进行系统级评测。
然而，在尝试使用KVM启动虚拟机时，由于处理器潜在的错误而失败。
软硬件联合调试的复杂性以及现有调试工具的能力限制使错误难以解决。
为了调试处理器的错误，我对尝试对现有的调试手段进行了探索和改进：
纯软件的差分测试能够准确定位错误现场，提供所需的调试波形图，
但仿真速度不可接受，尤其在需要启动操作系统和虚拟机的场景下。
因此，我尝试了体系结构检查点方法，能够跳过仿真操作系统启动的冗长时间。
FPGA仿真加速平台可以快速执行，获取任意时间点的微架构检查点，并在逻辑仿真软件中精确重放波形图。
然而，它对于获取体系结构信息的能力非常有限，难以帮助调试复杂系统。
因此，我提出了在差分测试框架中重放检查点，以及将差分测试硬件化在FPGA的两种想法。

\end{cabstract}

\begin{eabstract}
Virtualization is a key technology widely used in cloud services and data centers.
Driven by demand, mainstream computer architectures have implemented hardware extension support for virtualization.
As a open source instruction set, RISC-V has also begun to focus on the needs of cloud data centers, 
and thus proposed hypervisor extension specification, which provides a huge space for research.
In this paper, we focus on adding hypervisor extension to the open source RISC-V processor "XiangShan", 
and investigate three aspects: virtualization microarchitecture, system software, and debugging tools.

In terms of microarchitecture, 
we adopt a distributed L1 TLB and a centralized address translation engine to balance translation speed and timing pressure.
By caching the second stage page table in the L2 TLB, it is possible to speed up the translation from guest physical address to host physical address.
In addition, we have designed some delicate micro-architectures in the page table walker that can improve the throughput.

In terms of system software, we chose KVM as the target, 
booted Linux on XiangShan with hypervisor extension, and evaluated the host performance.
However, we encountered some problems which is difficult debugged when running KVM. 
The complexity of joint debugging of hardware and software,
and the limitations of existing debugging tools made it difficult to solve this problems.
  
In terms of debugging tools, we tried difftests based logic simulation software, 
as well as FPGA simulation acceleration platforma for joint debugging of hardware and software.
Pure software-based difftest can accurately locate the error site and provide waveform for debug, 
but the simulation speed is unacceptable, especially in our scenarios requiring boot the operating system and virtual machine.
Therefore, we tried architecture checkpoints that make it possible to starts the simulation after the operating system booted.
The FPGA simulation acceleration platform can speed up software executing, acquire microarchitecture checkpoints at any time, 
and replay the waveform in the logic simulation software.
However, it can not analyse architecture information to help complex systems debug.
Therefore, we propose replaying checkpoints in a difftest and hardwareizing difftest in FPGAs.
\end{eabstract}
